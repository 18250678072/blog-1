# 团队编码规范约束最佳实践

一千个人，就有一千个哈姆雷特。

一千个程序员，就有一千种代码风格。

那什么是代码风格呢？从小的来说，有的开发喜欢带分号，有的不喜欢带分号。有的喜欢使用空格，有的喜欢使用 Tab。有的喜欢空两个空格，有的喜欢四个空格。如果你是新参加工作的人员，又恰好遇到一个代码风格混乱的项目，只能有苦不能说了。

团队合作中需要权衡与妥协。

## 编码规范，可读性与代码质量

代码中最重要的一点是要去个性化，

## ESLint 与约束

## 编码规范统一与最佳实践

团队总设定统一的标准，然后随着标准走。

## 开发环境，生产环境与警告

开发环境对于开发而言重要的是什么？

是开发体验。

一个良好的编码规范会带来解放强迫症的舒适感，但过于严格的代码风格有时也会使人烦躁。试举两个小例子，有可能是在你写代码时出现过的场景：

1. 禁止掉 `console.log`，避免在生产环境输出多余的东西。但偏偏在测试环境经常需要调试，但是如果仅仅设为警告的话，警告又会被忽视，失去意义。
1. 特别是当设置了规则 `no-unused-vars` 时。如果仅仅是为了在开发时调试，却因为无法通过 ESlint 规则校验无法方便调试。

这是一个约束与自由的权衡，ESLint 在提供强有力约束时自然会牺牲一些开发上的便利性。中庸，儒家思想讲究中庸，此时可以在权衡下选择一个中庸的方案：

把 ESLint 的所有影响调试的规则校验都设置为 `Warn`，那你又问了警告往往不是会被忽略吗？是这样子的，所以需要在 CI 中设置环境变量 `CI=true`，如此在 CI 中即使有警告也无法交付。CI 指持续集成，在本篇文章后边也会接着提到，另外，在本系列文章中也会重点讲解 CI，欢迎持续关注。

如在 `create-react-app` 中的大部分规则都是设置为 `Warn`

![](./assets/eslint.jpg)

但是，如果你使用了 `webpack`，并且结合 `eslint-loader`，那解决方案就更加简单了：使用 `emitWarning: true`，在测试环境把所有 `Error` 都当做 `Warn`，这样避免了修改 ESLint 规则，`webpack` 的配置如下

``` js
{
  test: /\.(js|mjs|jsx|ts|tsx)$/,
  enforce: 'pre',
  use: [
    {
      options: {
        cache: true,
        emitWarning: true,
      },
      loader: require.resolve('eslint-loader'),
    },
  ]
}
```

所以有两种权衡开发体验与编程规范的方式：

1. 把 ESLint 的 rule 设置为 `Warn`，并在持续集成中配置环境变量 `CI=true`。
1. 结合 webpack 与 `eslint-loader`，根据当前环境的环境变量配置 `emitWarning`。

## 第一层约束: IDE

当不符合代码规范的第一时间，我们就要感知到它，及时反馈，快速纠正，比直到最后积攒了一大堆错误要高效很多。

这里以 `VS Code` 作为示例，它只需要安装一个插件：`eslint`，便可以做到智能提示，来看看效果吧：

![](./assets/eslint-vscode.jpg)

另外，配合 `eslint-loader`，使用浏览器也可以做到实时提示：

![](./assets/eslint-tip.jpg)

## 第二层约束: Git Hooks

团队合作中的编码规范有一点是，虽然自己有可能不舒服，但是不能让别人因为自己的代码而不舒服。

## 第三层约束: CI

## 编码自由度